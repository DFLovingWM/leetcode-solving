# 切披萨的方案数

## 思路

求方案数，一般就是DP题。

状态需要包括：

- 当前矩形：可以用左上角`(r1, c1)`和右下角`(r2, c2)`的坐标表示
- 当前已切出多少块：`k`

于是用五元组`(r1, c1, r2, c2, k)`表示。考虑状态转移：对于一块矩形披萨，可以有m种横切、n种竖切，只要保证切开的两半都有苹果就行。以上就是DP部分的思路。

第2个问题是，怎么快速判断矩阵中含有（至少1个）苹果呢？可以根据容斥原理，预处理出每个坐标点到原点（即左上角`(0, 0)`）含有的苹果数目。这样当给定`(r1, c1, r2, c2)`时，还是根据容斥原理，在`O(1)`时间便能判断是否含有苹果。需要注意对下标的处理要小心，这一步比较恶心。

时间复杂度：五元组为`O(KN^4)`，状态转移需要`O(N)`，所以总共是`O(KN^5)`。

## 优化

五元组是不必要的。

横切后，继续递归的是右边的；竖切后，是下边。也就是说整个过程中，矩形的右下角是不变的，始终是`(m-1, n-1)`。所以表示一个矩形只需要左上角坐标就好，整体时间就能降低为`O(KN^3)`！另外，前缀和预处理中，也能以右下角为起点，这样操作起来更方便。
