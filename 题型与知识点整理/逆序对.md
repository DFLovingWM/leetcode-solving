# 逆序对

## 定义

线性结构如数组中，当`i < j`并且`A[i] > A[j]`时，称`(i, j)`为1个逆序对。

实际上，逆序对的变形很多，只要满足`A[j] - A[i] < M`或者`A[j] - A[i] <= M`，`(i, j)`都能称为（某种条件下）的逆序对，于是都能用以下的套路解决。

题目的问法有：

- 给定数组，求逆序对的个数
- 给定数组，对每个数字求右边比它小的数字的个数
- 给定数组，求出所有逆序对

## 解决方案

一般有：

- 归并排序
- 树状数组（@todo 待补充）
- 线段树（@todo 待补充）

### 归并排序

归并排序的特点是：将左、右两部分变为有序，然后再合并这2个有序数组。

而在左（A）、右（B）2个子数组变为有序后，我们可以在A中找`A[i]`、B中找`B[j]`使得`B[j] - A[i] < M`。如果`B[j] - A[i] < M`：

- 因为A是升序的，则必定有`B[j] - A[i+1] < M`，所以对于下一个`A[i+1]`来说，可以接着从`B[j]`开始搜索，而不必重新从`B[0]`开始找
- 因为B也是升序的，所以对于`A[i]`，我们只需要递增`j`、直到找到第一个不满足条件的`B[j]`为止，然后`A[i]`这次的逆序对的个数增加`j - mid`

这一步保证了时间为O(N)，于是整体算法的时间复杂度为O(NlogN)。

## 题目

- [493. 翻转对](https://leetcode-cn.com/problems/reverse-pairs/)
- [315. 计算右侧小于当前元素的个数](https://leetcode-cn.com/problems/count-of-smaller-numbers-after-self/)
- [327. 区间和的个数](https://leetcode-cn.com/problems/count-of-range-sum/)
